var objectdetect=function(){"use strict";var r=function(r,a){var t=r.length;a||(a=new Uint32Array(t>>2));for(var e=0;t>e;e+=4)a[e>>2]=4899*r[e]+9617*r[e+1]+1868*r[e+2]+8192>>14;return a},a=function(r,a,t,e,o){var n=t*a,s=~~(a/e),i=~~(t/e);o||(o=new r.constructor(s*t));for(var c=0;s>c;++c)for(var v=c,f=~~(c*e),h=f+n;h>f;f+=a)o[v]=r[f],v+=s;for(var v=0,u=0,l=i*e;l>u;u+=e)for(var f=~~u*s,h=f+s;h>f;++f)o[v]=o[f],++v;return o},t=function(r,a,t,e){e||(e=new r.constructor(r.length));for(var o=0,n=0;t>n;++n){for(var s=a>>1;s>=0;--s){var i=r[o+s];e[o+s]=r[o+a-1-s],e[o+a-1-s]=i}o+=a}return e},e=function(r,a,t,e){var o=r.length;e||(e=new r.constructor(o));for(var n=e===r?new r.constructor(o):e,s=new r.constructor(o),i=2;a-2>i;++i)for(var c=i,v=0;t>v;++v)n[c]=.1117*r[c-2]+.2365*r[c-1]+.3036*r[c]+.2365*r[c+1]+.1117*r[c+2],c+=a;for(var i=0;a>i;++i)for(var c=i+a,v=2;t-2>v;++v)c+=a,s[c]=.1117*n[c-a-a]+.2365*n[c-a]+.3036*n[c]+.2365*n[c+a]+.1117*n[c+a+a];for(var f=Math.abs,i=2;a-2>i;++i)for(var c=i+a,v=2;t-2>v;++v)c+=a,e[c]=f(-s[c-1-a]+s[c+1-a]-2*s[c-1]+2*s[c+1]-s[c-1+a]+s[c+1+a])+f(s[c-1-a]+2*s[c-a]+s[c+1-a]-s[c-1+a]-2*s[c+a]-s[c+1+a]);return e},o=function(r,a,t,e){var o=a+1;e||(e=new Uint32Array(a*t+o+t));for(var n=t*o;n>=0;n-=o)e[n]=0;for(var s=1;a>=s;++s){var i=0,c=s;e[s]=0;for(var v=1;t>=v;++v)i+=r[c-v],c+=o,e[c]=e[c-1]+i}return e},n=function(r,a,t,e){var o=a+1;e||(e=new Uint32Array(a*t+o+t));for(var n=t*o;n>=0;n-=o)e[n]=0;for(var s=1;a>=s;++s){var i=0,c=s;e[s]=0;for(var v=1;t>=v;++v){var f=r[c-v];i+=f*f,c+=o,e[c]=e[c-1]+i}}return e},s=function(r,a,t,e){var o=a+1,n=t*o;e||(e=new Uint32Array(a*t+o+t));for(var s=n;s>=0;s-=o)e[s]=0;for(var s=o-1;s>=0;--s)e[s]=0;for(var i=0,c=0;t>c;++c){for(var v=0;a>v;++v)e[i+o+1]=r[i-c]+e[i],++i;e[i+o]+=e[i],i++}for(var v=a-1;v>0;--v)for(var i=v+n,c=t;c>0;--c)i-=o,e[i+o]+=e[i]+e[i+1];return e},i=function(r,a,t){var e=r.length;t||(t=r),a||(a=5);for(var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;e>n;n+=a)++o[r[n]];for(var s=255*a/e,i=0,n=0;256>n;++n){var c=o[n];i=c+=i,o[n]=c*s}for(var n=0;e>n;++n)t[n]=o[r[n]];return t},c=function(r,a){a||(a=new r.constructor(r));for(var t=r[0],e=1,o=r.length-1;o>e;){++e;for(var n=0,s=r[++e];s>n;++n){if(r[++e])for(var i=e+5*r[++e];i>e;){a[e+1]=t-r[e+1];var c=r[e+3];a[e+3]=r[e+4],a[e+4]=c,e+=5}else for(var i=e+5*r[++e];i>e;)a[e+1]=t-r[e+1]-r[e+3],e+=5;e+=3}}return a},v=function(r,a,t,e,o){a+=1,t+=1,o||(o=new Float32Array(r.length));var n=new Uint32Array(o.buffer);n[0]=r[0],n[1]=r[1];for(var s=1,i=1,c=r.length-1;c>i;){o[++s]=r[++i];for(var v=n[++s]=r[++i],f=0,h=v;h>f;++f){var u=o[++s]=r[++i],l=n[++s]=3*r[++i];if(u)for(var d=s+l;d>s;){var g=r[i+1]+r[i+2]*a,m=r[i+3]*(a+1),y=r[i+4]*(a-1);n[++s]=g,n[++s]=m+(y<<16),o[++s]=r[i+5],i+=5}else for(var d=s+l;d>s;){var g=r[i+1]+r[i+2]*a,b=r[i+3],y=r[i+4]*a;n[++s]=g,n[++s]=b+(y<<16),o[++s]=r[i+5],i+=5}for(var p=r[++i],w=0;l>w;)o[s-w]/=p,w+=3;0>p?(o[s+2]=r[++i],o[s+1]=r[++i],s+=2):(o[++s]=r[++i],o[++s]=r[++i])}}return o.subarray(0,s+1)},f=function(r,a,t,e,o,n,s,i){o+=1,n+=1;for(var c=new Uint32Array(i.buffer),v=c[0],f=c[1],h=f*o,u=v*f,l=1/u,d=o*s,g=[],m=0;o>m+v;m+=s)for(var y=m,b=0;n>b+f;b+=s){var p=y+v,w=y+h,M=w+v,A=!1;if(e){var G=(e[y]-e[p]-e[w]+e[M])*l;if(60>G||G>200){A=!0,y+=d;continue}}for(var S=r[y]-r[p]-r[w]+r[M],j=(t[y]-t[p]-t[w]+t[M])*u-S*S,C=j>1?Math.sqrt(j):1,U=!0,R=1,I=i.length-1;I>R;){for(var q=i[++R],x=0,k=0,F=c[++R];F>k;++k){var T=0;if(c[++R])for(var z=R+c[++R];z>R;){var D=y+c[++R],E=c[++R],H=D+(65535&E),B=D+(E>>16&65535);T+=i[++R]*(a[D]-a[H]-a[B]+a[H+B-D])}else for(var z=R+c[++R];z>R;){var D=y+c[++R],E=c[++R],H=D+(65535&E),B=D+(E>>16&65535);T+=i[++R]*(r[D]-r[H]-r[B]+r[H+B-D])}x+=i[R+(T>C?2:1)],R+=2}if(q>x){U=!1;break}}U&&g.push([m,b,v,f]),y+=d}return g},h=function(r,a,t){var e=r.length;t||(t=1);for(var o=0,n=new Array(e),s=0;s<n.length;++s)n[s]=0;for(var s=0;e>s;++s){for(var i=!1,c=0;s>c;++c){var v=r[s],f=r[c],h=t*(Math.min(v[2],f[2])+Math.min(v[3],f[3]));if(Math.abs(v[0]-f[0])<=h&&Math.abs(v[1]-f[1])<=h&&Math.abs(v[0]+v[2]-f[0]-f[2])<=h&&Math.abs(v[1]+v[3]-f[1]-f[3])<=h){n[s]=n[c],i=!0;break}}i||(n[s]=o++)}for(var u=new Array(o),s=0;o>s;++s)u[s]=[0,0,0,0,0];for(var s=0;e>s;++s){var l=r[s],d=u[n[s]];d[0]+=l[0],d[1]+=l[1],d[2]+=l[2],d[3]+=l[3],++d[4]}for(var s=o-1;s>=0;--s){var g=u[s][4];if(g>=a){var d=u[s];d[0]/=g,d[1]/=g,d[2]/=g,d[3]/=g}else u.splice(s,1)}for(var m=[],s=0;o>s;++s){for(var y=u[s],c=0;o>c;++c)if(s!==c){var b=u[c],p=.2*b[2],w=.2*b[3];if(y[0]>=b[0]-p&&y[1]>=b[1]-w&&y[0]+y[2]<=b[0]+b[2]+p&&y[1]+y[3]<=b[1]+b[3]+w)break}c===o&&m.push(y)}return m},u=function(){function r(r,a,t,e){this.canvas=document.createElement("canvas"),this.canvas.width=r,this.canvas.height=a,this.context=this.canvas.getContext("2d"),this.tilted=e.tilted,this.scaleFactor=t,this.numScales=~~(Math.log(Math.min(r/e[0],a/e[1]))/Math.log(t)),this.scaledGray=new Uint32Array(r*a),this.compiledClassifiers=[];for(var o=1,n=0;n<this.numScales;++n){var s=~~(r/o),i=~~(a/o);this.compiledClassifiers[n]=objectdetect.compileClassifier(e,s,i),o*=t}}return r.prototype.detect=function(r,a,t){t||(t=1);var e=this.canvas.width,o=this.canvas.height;this.context.drawImage(r,0,0,e,o);var n=this.context.getImageData(0,0,e,o).data;this.gray=objectdetect.convertRgbaToGrayscale(n,this.gray);for(var s=[],i=1,c=0;c<this.numScales;++c){var v=~~(e/i),h=~~(o/i);1==i?this.scaledGray.set(this.gray):this.scaledGray=objectdetect.rescaleImage(this.gray,e,o,i,this.scaledGray),this.sat=objectdetect.computeSat(this.scaledGray,v,h,this.sat),this.ssat=objectdetect.computeSquaredSat(this.scaledGray,v,h,this.ssat),this.tilted&&(this.rsat=objectdetect.computeRsat(this.scaledGray,v,h,this.rsat)),this.cannysat=void 0;for(var u=f(this.sat,this.rsat,this.ssat,this.cannysat,v,h,t,this.compiledClassifiers[c]),l=u.length-1;l>=0;--l)u[l][0]*=e/v,u[l][1]*=o/h,u[l][2]*=e/v,u[l][3]*=o/h;s=s.concat(u),i*=this.scaleFactor}return(a?objectdetect.groupRectangles(s,a):s).sort(function(r,a){return a[4]-r[4]})},r}();return{convertRgbaToGrayscale:r,rescaleImage:a,mirrorImage:t,computeCanny:e,equalizeHistogram:i,computeSat:o,computeRsat:s,computeSquaredSat:n,mirrorClassifier:c,compileClassifier:v,detect:f,groupRectangles:h,detector:u}}();